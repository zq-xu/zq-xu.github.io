import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.48927342.js";const h=JSON.parse('{"title":"Minikube集群安装","description":"","frontmatter":{"date":"2022-12-31T00:00:00.000Z"},"headers":[],"relativePath":"zh/cloud-native/kubernetes/installation/minikube.md","filePath":"zh/cloud-native/kubernetes/installation/minikube.md"}'),o={name:"zh/cloud-native/kubernetes/installation/minikube.md"},p=l(`<h1 id="minikube集群安装" tabindex="-1">Minikube集群安装 <a class="header-anchor" href="#minikube集群安装" aria-label="Permalink to &quot;Minikube集群安装&quot;">​</a></h1><p>Minikube是单节点的Kubernetes环境，常用于学习使用或作为开发环境。</p><h2 id="搭建环境" tabindex="-1">搭建环境 <a class="header-anchor" href="#搭建环境" aria-label="Permalink to &quot;搭建环境&quot;">​</a></h2><p>服务器信息和基础环境如下：</p><ul><li>OS: Linux</li><li>Kubectl: v1.22.3</li><li>Minikube: v1.24.0</li><li>Golang: 1.15.15</li><li>Docker: 1.41 (<a href="/zh/tools/docker.html">Docker安装</a>)</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果使用中国境内网络，为避免网络影响，可以设置GOPROXY为以下任意一个：</p><ul><li>export GOPROXY=&quot;<a href="https://proxy.golang.org" target="_blank" rel="noreferrer">https://proxy.golang.org</a>,direct&quot;</li><li>export GOPROXY=&quot;<a href="https://goproxy.cn" target="_blank" rel="noreferrer">https://goproxy.cn</a>&quot;</li></ul></div><h2 id="安装kubectl" tabindex="-1">安装Kubectl <a class="header-anchor" href="#安装kubectl" aria-label="Permalink to &quot;安装Kubectl&quot;">​</a></h2><ul><li><strong>步骤一</strong> 下载二进制文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-LO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://storage.googleapis.com/kubernetes-release/release/$(</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-LO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://storage.googleapis.com/kubernetes-release/release/$(</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</span></span></code></pre></div><ul><li><strong>步骤二</strong> 修改二进制文件权限及路径</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/kubectl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/kubectl</span></span></code></pre></div><h2 id="安装minikube" tabindex="-1">安装Minikube <a class="header-anchor" href="#安装minikube" aria-label="Permalink to &quot;安装Minikube&quot;">​</a></h2><ul><li><strong>步骤一</strong> 下载二进制文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Lo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Lo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span></span></code></pre></div><ul><li><strong>步骤二</strong> 修改二进制文件权限及路径</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minikube</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minikube</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/</span></span></code></pre></div><ul><li><strong>步骤二</strong> 安装依赖工具<code>conntrack</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">conntrack</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">conntrack</span></span></code></pre></div><h2 id="使用minikube启动集群" tabindex="-1">使用Minikube启动集群 <a class="header-anchor" href="#使用minikube启动集群" aria-label="Permalink to &quot;使用Minikube启动集群&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--vm-driver=none</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--vm-driver=none</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</span></span></code></pre></div><p>启动参数说明：</p><ul><li>--vm-driver: 虚拟机驱动，如果使用本地服务器环境启动，设置为node即可；</li><li>--image-repository: 指定镜像仓库源，主要用于中国网络/私有网络无法访问google镜像的场景；</li><li>--kubernetes-version: 指定Kubernetes版本，如&quot;v1.18.20&quot;；</li></ul><h2 id="查看集群状态" tabindex="-1">查看集群状态 <a class="header-anchor" href="#查看集群状态" aria-label="Permalink to &quot;查看集群状态&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## 健康的集群状态示例如下：</span></span>
<span class="line"><span style="color:#B392F0;">minikube</span></span>
<span class="line"><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Control</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Plane</span></span>
<span class="line"><span style="color:#B392F0;">host:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">kubelet:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">apiserver:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">kubeconfig:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Configured</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## 健康的集群状态示例如下：</span></span>
<span class="line"><span style="color:#6F42C1;">minikube</span></span>
<span class="line"><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Control</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Plane</span></span>
<span class="line"><span style="color:#6F42C1;">host:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">kubelet:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">apiserver:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">kubeconfig:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Configured</span></span></code></pre></div><h2 id="配置kubeconfig" tabindex="-1">配置Kubeconfig <a class="header-anchor" href="#配置kubeconfig" aria-label="Permalink to &quot;配置Kubeconfig&quot;">​</a></h2><p>配置<code>Kubeconfig</code>,方可使用<code>Kubectl</code>指令直接操作Kubernetes集群：</p><ul><li><strong>步骤一</strong> 修改二进制文件权限及路径</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># USER: 操作用户的名称，取自环境变量$USER即可</span></span>
<span class="line"><span style="color:#6A737D;"># HOME: 操作用户的HOME路径，取自环境变量$HOME即可</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/.kube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/.minikube</span><span style="color:#E1E4E8;"> $HOME</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> $USER $HOME</span><span style="color:#9ECBFF;">/.kube</span><span style="color:#E1E4E8;"> $HOME</span><span style="color:#9ECBFF;">/.minikube</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># USER: 操作用户的名称，取自环境变量$USER即可</span></span>
<span class="line"><span style="color:#6A737D;"># HOME: 操作用户的HOME路径，取自环境变量$HOME即可</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/.kube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/.minikube</span><span style="color:#24292E;"> $HOME</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chown</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> $USER $HOME</span><span style="color:#032F62;">/.kube</span><span style="color:#24292E;"> $HOME</span><span style="color:#032F62;">/.minikube</span></span></code></pre></div><ul><li><strong>步骤二</strong> 修改文件<code>$HOME/.kube/config</code>,将其中的&quot;/root&quot;字段修改为<code>$HOME</code>对应路径。</li></ul><h2 id="可视化界面" tabindex="-1">可视化界面 <a class="header-anchor" href="#可视化界面" aria-label="Permalink to &quot;可视化界面&quot;">​</a></h2><p><code>Minikube Dashboard</code>是使用Minikube启动的Kubernetes自带的可视化界面，可使用以下指令启动：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">minikube</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--url</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动成功示例如下：</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Verifying dashboard health ...</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Launching proxy ...</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Verifying proxy health ...</span></span>
<span class="line"><span style="color:#B392F0;">http://127.0.0.1:44509/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">minikube</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dashboard</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--url</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动成功示例如下：</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Verifying dashboard health ...</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Launching proxy ...</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Verifying proxy health ...</span></span>
<span class="line"><span style="color:#6F42C1;">http://127.0.0.1:44509/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span></span></code></pre></div><p>在安装Minikube的执行机上，使用本地浏览器中访问打印信息中的地址即可。</p><p>若需要在非安装机器上远程访问可视化界面，则可以使用<code>Kubectl</code>指令开启访问代理：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 指定执行机的8001号端口作为代理</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">nohup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proxy</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port=8001</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--address=</span><span style="color:#9ECBFF;">&#39;0.0.0.0&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--accept-hosts=</span><span style="color:#9ECBFF;">&#39;^*$&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/dev/null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">2&gt;&amp;1</span><span style="color:#E1E4E8;">&amp;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 指定执行机的8001号端口作为代理</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">nohup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proxy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=8001</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--address=</span><span style="color:#032F62;">&#39;0.0.0.0&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--accept-hosts=</span><span style="color:#032F62;">&#39;^*$&#39;</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/dev/null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">2&gt;&amp;1</span><span style="color:#24292E;">&amp;</span></span></code></pre></div><p>开启代理之后，即可使用以下地址远程访问可视化界面(ip为执行机ip)：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">http://$ip:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">http://$ip:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span></span></code></pre></div>`,37),e=[p];function t(c,r,i,y,E,u){return a(),n("div",null,e)}const b=s(o,[["render",t]]);export{h as __pageData,b as default};
