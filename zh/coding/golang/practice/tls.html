<!DOCTYPE html>
<html lang="zh-cmn-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TLS的Golang应用 | ZQ-XU</title>
    <meta name="description" content="ZQ-XU的个人博客">
    <link rel="preload stylesheet" href="/assets/style.08ccb2ee.css" as="style">
    
    <script type="module" src="/assets/app.189c6f42.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.48927342.js">
    <link rel="modulepreload" href="/assets/chunks/theme.5e54692e.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-ae26940c.2e248f94.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-791cd6ce.223db9a3.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-ba221793.ba697412.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-98d114f5.0a459116.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-2a92ed83.e848943f.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-2f2b3e35.dd3e6d32.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-71364981.c704b319.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-62059850.7ba3ea8c.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-eefba29b.d10db7bb.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-6a2e589f.dea1aba9.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-415e57eb.9b74fea8.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-aa2e62c5.8d38c6e0.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-115132f8.87c2f61c.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-956145d5.e7241728.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-e78ef88c.f53f7996.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-a9730694.a5887b88.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-b51952f5.70d8cee9.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-8fc01fef.6c492029.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-6b172555.77848354.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-081bcda6.b2b6b4bc.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.ade1a5ba.js">
    <link rel="modulepreload" href="/assets/zh_coding_golang_practice_tls.md.f9c8be2f.lean.js">
    <meta name="theme-color" content="#ffffff">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <link rel="alternate icon" href="/images/favicon.png" type="image/png" sizes="16x16">
    <meta name="author" content="ZQ-XU">
    <link rel="mask-icon" href="/images/favicon.png" color="#ffffff">
    <link rel="apple-touch-icon" href="/images/favicon.png" sizes="180x180">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-fc7ad6c7 data-v-329f128b><!--[--><!----><!--[--><div class="theme-blog-popover" style="display:none;" data-pagefind-ignore="all" data-v-ed4981f4><div class="header" data-v-ed4981f4><div class="title-wrapper" data-v-ed4981f4><i class="el-icon" style="font-size:20px;" data-v-ed4981f4><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-ed4981f4><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i><span class="title" data-v-ed4981f4>公告</span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-ed4981f4><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-ed4981f4><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg><!--]--></i></div><div class="body content" data-v-ed4981f4><!--[--><p style="" data-v-ed4981f4>👇 微信 👇 欢迎大家私信交流</p><img src="/images/more/wechat-qrcode.png" style="" data-v-ed4981f4><!--]--><!----></div><div class="footer content" data-v-ed4981f4><!--[--><!--]--></div></div><div class="theme-blog-popover-close" style="" data-v-ed4981f4><i class="el-icon" style="font-size:20px;" data-v-ed4981f4><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-ed4981f4><path fill="currentColor" d="M288 128h608L736 384l160 256H288v320h-96V64h96v64z"></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-72a98cf4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-72a98cf4> Skip to content </a><!--]--><!----><header class="VPNav" data-v-329f128b data-v-b2c29f56><div class="VPNavBar has-sidebar" data-v-b2c29f56 data-v-ecad55b2><div class="container" data-v-ecad55b2><div class="title" data-v-ecad55b2><div class="VPNavBarTitle has-sidebar" data-v-ecad55b2 data-v-afd1f3db><a class="title" href="/" data-v-afd1f3db><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-09ae590e><!--]--><!--[-->ZQ-XU<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-ecad55b2><div class="curtain" data-v-ecad55b2></div><div class="content-body" data-v-ecad55b2><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-ecad55b2 style="--83c41620:1;" data-v-324b3e0c><div class="nav-search-btn-wait" data-v-324b3e0c><svg width="14" height="14" viewBox="0 0 20 20" data-v-324b3e0c><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-324b3e0c></path></svg><span class="search-tip" data-v-324b3e0c>Search</span><span class="metaKey" data-v-324b3e0c> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ecad55b2 data-v-ed562961><span id="main-nav-aria-label" class="visually-hidden" data-v-ed562961>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-ed562961 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-19908537><span class="text" data-v-19908537><!----><span data-v-19908537>开源杂记</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-19908537><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><div class="items" data-v-b948172a><!--[--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/open-source/tekton/index.html" data-v-cc062915><!--[-->Tekton -- 云原生CI工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/open-source/vitess/index.html" data-v-cc062915><!--[-->Vitess -- 数据库分库分表解决方案<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-ed562961 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-19908537><span class="text" data-v-19908537><!----><span data-v-19908537>云原生</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-19908537><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><div class="items" data-v-b948172a><!--[--><!--[--><div class="VPMenuGroup" data-v-b948172a data-v-92227db6><p class="title" data-v-92227db6>Kubernetes</p><!--[--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/overview.html" data-v-cc062915><!--[-->Kubernetes基础<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/installation.html" data-v-cc062915><!--[-->Kubernetes安装<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/configuration.html" data-v-cc062915><!--[-->Kubernetes常用配置<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/operation.html" data-v-cc062915><!--[-->Kubernetes常用操作<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/crd-operator.html" data-v-cc062915><!--[-->CRD &amp;&amp; Operator<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/practice.html" data-v-cc062915><!--[-->Kubernetes实践<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/cloud-native/kubernetes/reference.html" data-v-cc062915><!--[-->Kubernetes参考<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-ed562961 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-19908537><span class="text" data-v-19908537><!----><span data-v-19908537>手撕代码</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-19908537><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><div class="items" data-v-b948172a><!--[--><!--[--><div class="VPMenuGroup" data-v-b948172a data-v-92227db6><p class="title" data-v-92227db6>Golang</p><!--[--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/golang/reference.html" data-v-cc062915><!--[-->Golang参考资源<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/golang/standards.html" data-v-cc062915><!--[-->Golang编码规范<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/golang/design-patterns.html" data-v-cc062915><!--[-->Golang设计模式<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/golang/practice.html" data-v-cc062915><!--[-->Golang实践<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b948172a data-v-92227db6><p class="title" data-v-92227db6>Vue &amp; Vite</p><!--[--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/vue-vite/reference.html" data-v-cc062915><!--[-->Vue/Vite参考资源<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/vue-vite/docs-build.html" data-v-cc062915><!--[-->Web示例/文档/博客构建<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/vue-vite/gh-pages.html" data-v-cc062915><!--[-->Github Pages部署<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-92227db6 data-v-cc062915><a class="VPLink link" href="/zh/coding/vue-vite/command.html" data-v-cc062915><!--[-->Vue/Vite常用指令<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-ed562961 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-19908537><span class="text" data-v-19908537><!----><span data-v-19908537>常用工具</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-19908537><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><div class="items" data-v-b948172a><!--[--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/git.html" data-v-cc062915><!--[-->Git工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/docker.html" data-v-cc062915><!--[-->Docker<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/harbor.html" data-v-cc062915><!--[-->Harbor镜像仓库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/kubeadm.html" data-v-cc062915><!--[-->Kubeadm工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/kubectl.html" data-v-cc062915><!--[-->Kubectl工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/helm.html" data-v-cc062915><!--[-->Helm工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/helm-push.html" data-v-cc062915><!--[-->Helm-Push插件<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/helm-chartmuseum.html" data-v-cc062915><!--[-->Helm仓库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/nfs-server.html" data-v-cc062915><!--[-->NFS Server<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/tools/nfs-client.html" data-v-cc062915><!--[-->NFS Client<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-ed562961 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-19908537><span class="text" data-v-19908537><!----><span data-v-19908537>了解更多</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-19908537><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><div class="items" data-v-b948172a><!--[--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/more/aboutme.html" data-v-cc062915><!--[-->个人简介<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link" href="/zh/more/resource-share.html" data-v-cc062915><!--[-->资源分享<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b948172a data-v-cc062915><a class="VPLink link vp-external-link-icon" href="https://hub.docker.com/u/zqxu1993" target="_blank" rel="noreferrer" data-v-cc062915><!--[-->DockerHub<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ecad55b2 data-v-c37f87ef><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-c37f87ef data-v-de8c4290 data-v-47733c00><span class="check" data-v-47733c00><span class="icon" data-v-47733c00><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-de8c4290><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-de8c4290><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ecad55b2 data-v-3f5b75fa data-v-483bd59c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zq-xu/zq-xu.github.io" aria-label="github" target="_blank" rel="noopener" data-v-483bd59c data-v-bd7c34ff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ecad55b2 data-v-43da03e4 data-v-19908537><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-19908537><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-19908537><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-19908537><div class="VPMenu" data-v-19908537 data-v-b948172a><!----><!--[--><!--[--><!----><div class="group" data-v-43da03e4><div class="item appearance" data-v-43da03e4><p class="label" data-v-43da03e4>Appearance</p><div class="appearance-action" data-v-43da03e4><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-43da03e4 data-v-de8c4290 data-v-47733c00><span class="check" data-v-47733c00><span class="icon" data-v-47733c00><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-de8c4290><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-de8c4290><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-43da03e4><div class="item social-links" data-v-43da03e4><div class="VPSocialLinks social-links-list" data-v-43da03e4 data-v-483bd59c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zq-xu/zq-xu.github.io" aria-label="github" target="_blank" rel="noopener" data-v-483bd59c data-v-bd7c34ff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ecad55b2 data-v-c7027d6e><span class="container" data-v-c7027d6e><span class="top" data-v-c7027d6e></span><span class="middle" data-v-c7027d6e></span><span class="bottom" data-v-c7027d6e></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-329f128b data-v-3ea5a6e8><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-3ea5a6e8><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-3ea5a6e8><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-3ea5a6e8>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-3ea5a6e8 data-v-aaf7fb06><button data-v-aaf7fb06>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-329f128b data-v-7f19105b><div class="curtain" data-v-7f19105b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-7f19105b><span class="visually-hidden" id="sidebar-aria-label" data-v-7f19105b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-7f19105b><div class="VPSidebarItem level-0" data-v-7f19105b data-v-78885c4f><!----><!----></div></div><!--]--><!--[--><!--[--><!--[--><!--]--><div class="sidebar" data-pagefind-ignore="all" data-v-fc7ad6c7 style="--13db00b4:40px;--b7fa55c6:60px;" data-v-50a29f2d><div class="recommend" data-pagefind-ignore="all" data-v-50a29f2d style="--5d1afe17:0px;" data-v-4eeddbca><div class="card-header" data-v-4eeddbca><span class="title" data-v-4eeddbca>🔍 相关文章</span><!----></div><ol class="recommend-container" data-v-4eeddbca><!--[--><li data-v-4eeddbca><i class="num" data-v-4eeddbca>1</i><div class="des" data-v-4eeddbca><a class="el-link el-link--info is-underline title" href="/zh/coding/golang/practice/float" data-v-4eeddbca><!--v-if--><span class="el-link__inner"><!--[-->Float类型处理<!--]--></span><!--v-if--></a><div class="suffix" data-v-4eeddbca><span class="tag" data-v-4eeddbca>2023-10-16</span></div></div></li><li data-v-4eeddbca><i class="num" data-v-4eeddbca>2</i><div class="des" data-v-4eeddbca><a class="el-link el-link--info is-underline title current" href="/zh/coding/golang/practice/tls" data-v-4eeddbca><!--v-if--><span class="el-link__inner"><!--[-->TLS的Golang应用<!--]--></span><!--v-if--></a><div class="suffix" data-v-4eeddbca><span class="tag" data-v-4eeddbca>2023-04-13</span></div></div></li><li data-v-4eeddbca><i class="num" data-v-4eeddbca>3</i><div class="des" data-v-4eeddbca><a class="el-link el-link--info is-underline title" href="/zh/coding/golang/practice/jwt" data-v-4eeddbca><!--v-if--><span class="el-link__inner"><!--[-->JWT鉴权<!--]--></span><!--v-if--></a><div class="suffix" data-v-4eeddbca><span class="tag" data-v-4eeddbca>2023-04-20</span></div></div></li><li data-v-4eeddbca><i class="num" data-v-4eeddbca>4</i><div class="des" data-v-4eeddbca><a class="el-link el-link--info is-underline title" href="/zh/coding/golang/practice/time-json" data-v-4eeddbca><!--v-if--><span class="el-link__inner"><!--[-->自定义时间类型的JSON字符<!--]--></span><!--v-if--></a><div class="suffix" data-v-4eeddbca><span class="tag" data-v-4eeddbca>6天前</span></div></div></li><!--]--></ol></div></div><!--]--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-pagefind-body data-v-329f128b data-v-519768f5><div class="VPDoc has-sidebar has-aside" data-v-519768f5 data-v-dcd5a9aa><!--[--><!--]--><div class="container" data-v-dcd5a9aa><div class="aside" data-v-dcd5a9aa><div class="aside-curtain" data-v-dcd5a9aa></div><div class="aside-container" data-v-dcd5a9aa><div class="aside-content" data-v-dcd5a9aa><div class="VPDocAside" data-v-dcd5a9aa data-v-224c7d66><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-224c7d66 data-v-8c5d4870><div class="content" data-v-8c5d4870><div class="outline-marker" data-v-8c5d4870></div><div class="outline-title" role="heading" aria-level="2" data-v-8c5d4870>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-8c5d4870><span class="visually-hidden" id="doc-outline-aria-label" data-v-8c5d4870> Table of Contents for current page </span><ul class="root" data-v-8c5d4870 data-v-14ca443e><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-224c7d66></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-dcd5a9aa><div class="content-container" data-v-dcd5a9aa><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-dcd5a9aa><div style="position:relative;" class="vp-doc _zh_coding_golang_practice_tls" data-v-dcd5a9aa><div><h1 id="tls的golang应用" tabindex="-1">TLS的Golang应用 <a class="header-anchor" href="#tls的golang应用" aria-label="Permalink to &quot;TLS的Golang应用&quot;">​</a></h1><h2 id="tls简介" tabindex="-1">TLS简介 <a class="header-anchor" href="#tls简介" aria-label="Permalink to &quot;TLS简介&quot;">​</a></h2><p><code>TLS</code>通常是指传输层安全(Transport Layer Security),是一种广泛使用的安全性协议。其由<code>Netscape</code>公司开发的安全套接字层(Secure Socket Layer，简称SSL)演变而来，<code>TLS</code>的1.0版本实际上就是<code>SSL</code>的3.1版本，是由<code>IETF</code>(Internet Engineering Task Force，Internet工程任务组)对<code>SSL</code>的3.0版本进行了标准化处理并添加了少数机制，可以看作是SSL的升级版。事实上我们现在用的都是TLS，但因为历史上习惯了SSL这个称呼。</p><p><code>TLS</code>通常用于网络传输加密，我们常见的<code>HTTPS</code>就是在<code>HTTP</code>的基础上进行了<code>TLS</code>加密，从而使得网络传输更加安全可靠。<br> 如今，受<code>TLS</code>保护的<code>HTTPS</code>是网站的标准做法。</p><h2 id="tls原理" tabindex="-1">TLS原理 <a class="header-anchor" href="#tls原理" aria-label="Permalink to &quot;TLS原理&quot;">​</a></h2><p>此处参考<a href="https://zhuyasen.com/post/certificate.html" target="_blank" rel="noreferrer">TLS和SSL</a></p><h3 id="tls认证方式" tabindex="-1">TLS认证方式 <a class="header-anchor" href="#tls认证方式" aria-label="Permalink to &quot;TLS认证方式&quot;">​</a></h3><p><code>TLS</code>有单向认证和双向认证两种方式：</p><ul><li>单向认证指的是只有一个对象校验对端的证书合法性，通常都是client来校验服务器的合法性，那么client需要一个ca.crt，服务器需要server.crt、server.key。</li><li>双向认证指的是相互校验，服务器需要校验每个client，client也需要校验服务器。server需要server.key 、server.crt 、ca.crt文件；client也需要client.key 、client.crt 、ca.crt文件。</li></ul><h3 id="tls握手通信机制" tabindex="-1">TLS握手通信机制 <a class="header-anchor" href="#tls握手通信机制" aria-label="Permalink to &quot;TLS握手通信机制&quot;">​</a></h3><p>TLS/SSL协议的基本过程：</p><p>客户端向服务器端索要并验证公钥。 双方协商生成”对话密钥”。 双方采用”对话密钥”进行加密通信。 客户端和服务器端在正式通信之前经过握手阶段，”握手阶段”涉及四次通信，如下图所示：</p><p><img src="/images/coding/golang/TLS_handshake.png" alt="TLS握手流程"></p><p>“握手阶段”的所有通信都是明文的，握手完成之后是通信内容是经过秘钥加密的.</p><p>握手过程说明如下：</p><ol><li><p>客户端发出请求(ClientHello)</p><p>首先，客户端(通常是浏览器)先向服务器发出加密通信的请求，这被叫做ClientHello请求，在这一步客户端主要向服务器提供以下信息。</p><ul><li>支持的协议版本，比如TLS 1.0版。</li><li>一个客户端生成的随机数，稍后用于生成”对话密钥”。</li><li>支持的加密方法，比如RSA公钥加密。</li><li>支持的压缩方法。</li></ul><p>这里需要注意的是，客户端发送的信息之中不包括服务器的域名。也就是说，理论上服务器只能包含一个网站，否则会分不清应该向客户端提供哪一个网站的数字证书。这就是为什么通常一台服务器只能有一张数字证书的原因。对于虚拟主机的用户来说，这当然很不方便。2006年，TLS协议加入了一个Server Name Indication扩展，允许客户端向服务器提供它所请求的域名。</p></li><li><p>服务器回应(SeverHello)</p><p>服务器收到客户端请求后，向客户端发出回应，这叫做SeverHello，服务器的回应包含以下内容：</p><ul><li>确认使用的加密通信协议版本，比如TLS 1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信。</li><li>一个服务器生成的随机数，稍后用于生成”对话密钥”。</li><li>确认使用的加密方法，比如RSA公钥加密。</li><li>服务器证书。</li></ul><p>除了上面这些信息，如果服务器需要确认客户端的身份，就会再包含一项请求，要求客户端提供”客户端证书”。比如，金融机构往往只允许认证客户连入自己的网络，就会向正式客户提供USB密钥，里面就包含了一张客户端证书。</p></li><li><p>客户端回应</p><p>客户端收到服务器回应以后，首先验证服务器证书。如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。如果证书没有问题，客户端就会从证书中取出服务器的公钥。然后，向服务器发送下面三项信息：</p><ul><li>一个随机数。该随机数用服务器公钥加密，防止被窃听。</li><li>编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。</li><li>客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验。</li></ul><p>上面第一项的随机数，是整个握手阶段出现的第三个随机数，又称”pre-master key”。有了它以后，客户端和服务器就同时有了三个随机数，接着双方就用事先商定的加密方法，各自生成本次会话所用的同一把”会话密钥”。</p><p>注：如果前一步服务器要求客户端证书，客户端会在这一步发送证书及相关信息。</p></li><li><p>服务器的最后回应</p><p>服务器收到客户端的第三个随机数pre-master key之后，计算生成本次会话所用的”会话密钥”，向客户端最后发送下面信息：</p><ul><li>编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。</li><li>服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。</li></ul><p>整个握手阶段全部结束，接下来客户端与服务器进入加密通信，就完全是使用普通的HTTP协议，只不过用”会话密钥”加密内容。</p></li></ol><h2 id="tls服务准备" tabindex="-1">TLS服务准备 <a class="header-anchor" href="#tls服务准备" aria-label="Permalink to &quot;TLS服务准备&quot;">​</a></h2><p>使用<code>TLS</code>加密需要加载相应的证书。<code>TLS</code>证书由证书权威机构颁发给拥有域的个人或企业，该证书包含有关域所有者的重要信息以及服务器的公钥。</p><p>在开发环境中，也可以使用<code>openssl</code>工具制作自签名证书来作为<code>TLS</code>证书使用：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">openssl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">genrsa</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"><span style="color:#B392F0;">openssl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">req</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-x509</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server.pem</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-days</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3650</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">genrsa</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span>
<span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">req</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-x509</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server.pem</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-days</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3650</span></span></code></pre></div><p>以上指令生成了自签名私钥文件<code>server.key</code>和证书文件<code>server.pem</code>，可作为开发环境中的<code>TLS</code>证书使用。</p><p>如需在<code>Golang</code>项目中通过代码自动生成自签名<code>TLS</code>证书，可参考<a href="#golang实现自签名证书">Golang实现自签名证书</a>。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>生产环境的<code>TLS</code>证书最好还是去专业的机构申请。</p></div><h2 id="gin框架启动https服务" tabindex="-1">Gin框架启动HTTPS服务 <a class="header-anchor" href="#gin框架启动https服务" aria-label="Permalink to &quot;Gin框架启动HTTPS服务&quot;">​</a></h2><p>在<code>Golang</code>的Web项目中，可以使用<code>TLS</code>实现网络传输加密，从而构建相应的<code>HTTPS</code>服务。 此处以<code>Gin</code>框架为例，运行<code>HTTPS</code>服务：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">router</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">net</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">github.com/gin-gonic/gin</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">	RouterCfg </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">RouterConfig{}</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RouterConfig</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">struct</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">	IP   </span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">	Port </span><span style="color:#F97583;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	DisableTLS </span><span style="color:#F97583;">bool</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// For develop, use the command below to generate the private key and cert:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">//     for key:  openssl genrsa -out server.key 2048</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">//     for cert: openssl req -new -x509 -key server.key -out server.pem -days 3650</span></span>
<span class="line"><span style="color:#E1E4E8;">	KeyPath  </span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">	CertPath </span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">StartRouter</span><span style="color:#E1E4E8;">(r </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">gin.Engine) </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">	addr </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> net.</span><span style="color:#79B8FF;">JoinHostPort</span><span style="color:#E1E4E8;">(RouterCfg.IP, RouterCfg.Port)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> RouterCfg.DisableTLS {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> r.</span><span style="color:#79B8FF;">Run</span><span style="color:#E1E4E8;">(addr)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> r.</span><span style="color:#79B8FF;">RunTLS</span><span style="color:#E1E4E8;">(addr, RouterCfg.CertPath, RouterCfg.KeyPath)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">router</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">net</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">github.com/gin-gonic/gin</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">	RouterCfg </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">RouterConfig{}</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RouterConfig</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">struct</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">	IP   </span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">	Port </span><span style="color:#D73A49;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	DisableTLS </span><span style="color:#D73A49;">bool</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// For develop, use the command below to generate the private key and cert:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">//     for key:  openssl genrsa -out server.key 2048</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">//     for cert: openssl req -new -x509 -key server.key -out server.pem -days 3650</span></span>
<span class="line"><span style="color:#24292E;">	KeyPath  </span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">	CertPath </span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">StartRouter</span><span style="color:#24292E;">(r </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">gin.Engine) </span><span style="color:#D73A49;">error</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">	addr </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> net.</span><span style="color:#005CC5;">JoinHostPort</span><span style="color:#24292E;">(RouterCfg.IP, RouterCfg.Port)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> RouterCfg.DisableTLS {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> r.</span><span style="color:#005CC5;">Run</span><span style="color:#24292E;">(addr)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> r.</span><span style="color:#005CC5;">RunTLS</span><span style="color:#24292E;">(addr, RouterCfg.CertPath, RouterCfg.KeyPath)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>以上部分代码使用<code>Gin</code>框架加载指定路径的<code>TLS</code>证书，从而启动<code>HTTPS</code>服务。</p><h2 id="golang实现自签名证书" tabindex="-1">Golang实现自签名证书 <a class="header-anchor" href="#golang实现自签名证书" aria-label="Permalink to &quot;Golang实现自签名证书&quot;">​</a></h2><p>对于Golang项目，在开发环境或者Demo项目中，为了方便起见，往往需要在代码层面自动生成自签名<code>TLS</code>证书。</p><p>以下代码借鉴<a href="https://github.com/argoproj/argo-cd/blob/master/util/tls/tls.go" target="_blank" rel="noreferrer">argo-cd</a>，实现自签名<code>TLS</code>证书的生成：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">router</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/ecdsa</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/elliptic</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/rand</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/rsa</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/tls</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/x509</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">crypto/x509/pkix</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">encoding/pem</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">fmt</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">math/big</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">net</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">os</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">time</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">	DefaultRSABits </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CertOptions</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">struct</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// Hostnames and IPs to generate a certificate for</span></span>
<span class="line"><span style="color:#E1E4E8;">	Hosts []</span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// Name of organization in certificate</span></span>
<span class="line"><span style="color:#E1E4E8;">	Organization </span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// Creation date</span></span>
<span class="line"><span style="color:#E1E4E8;">	ValidFrom time.Time</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// Duration that certificate is valid for</span></span>
<span class="line"><span style="color:#E1E4E8;">	ValidFor time.Duration</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// whether this cert should be its own Certificate Authority</span></span>
<span class="line"><span style="color:#E1E4E8;">	IsCA </span><span style="color:#F97583;">bool</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// Size of RSA key to generate. Ignored if --ecdsa-curve is set</span></span>
<span class="line"><span style="color:#E1E4E8;">	RSABits </span><span style="color:#F97583;">int</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">// ECDSA curve to use to generate a key. Valid values are P224, P256 (recommended), P384, P521</span></span>
<span class="line"><span style="color:#E1E4E8;">	ECDSACurve </span><span style="color:#F97583;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// GeneratePEM generates a new certificate and key and returns it as PEM encoded bytes</span></span>
<span class="line"><span style="color:#6A737D;">// refers to the argo-cd: https://github.com/argoproj/argo-cd/blob/master/util/tls/tls.go</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GeneratePEM</span><span style="color:#E1E4E8;">(opts CertOptions) ([]</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">, []</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	certBytes, privateKey, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">generate</span><span style="color:#E1E4E8;">(opts)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, err</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	certpem </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> pem.</span><span style="color:#79B8FF;">EncodeToMemory</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">pem.Block{Type: </span><span style="color:#9ECBFF;">&quot;CERTIFICATE&quot;</span><span style="color:#E1E4E8;">, Bytes: certBytes})</span></span>
<span class="line"><span style="color:#E1E4E8;">	keypem </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> pem.</span><span style="color:#79B8FF;">EncodeToMemory</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">pemBlockForKey</span><span style="color:#E1E4E8;">(privateKey))</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> certpem, keypem, </span><span style="color:#79B8FF;">nil</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// GenerateX509KeyPair generates a X509 key pair</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GenerateX509KeyPair</span><span style="color:#E1E4E8;">(opts CertOptions) (</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">tls.Certificate, </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	certpem, keypem, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">GeneratePEM</span><span style="color:#E1E4E8;">(opts)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, err</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	cert, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> tls.</span><span style="color:#79B8FF;">X509KeyPair</span><span style="color:#E1E4E8;">(certpem, keypem)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, err</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">cert, </span><span style="color:#79B8FF;">nil</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">generate</span><span style="color:#E1E4E8;">(opts CertOptions) ([]</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">, crypto.PrivateKey, </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(opts.Hosts) </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;hosts not supplied&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> privateKey crypto.PrivateKey</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">error</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> opts.ECDSACurve {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		rsaBits </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> DefaultRSABits</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> opts.RSABits </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">			rsaBits </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> opts.RSABits</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">		privateKey, err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rsa.</span><span style="color:#79B8FF;">GenerateKey</span><span style="color:#E1E4E8;">(rand.Reader, rsaBits)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;P224&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		privateKey, err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ecdsa.</span><span style="color:#79B8FF;">GenerateKey</span><span style="color:#E1E4E8;">(elliptic.</span><span style="color:#79B8FF;">P224</span><span style="color:#E1E4E8;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;P256&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		privateKey, err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ecdsa.</span><span style="color:#79B8FF;">GenerateKey</span><span style="color:#E1E4E8;">(elliptic.</span><span style="color:#79B8FF;">P256</span><span style="color:#E1E4E8;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;P384&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		privateKey, err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ecdsa.</span><span style="color:#79B8FF;">GenerateKey</span><span style="color:#E1E4E8;">(elliptic.</span><span style="color:#79B8FF;">P384</span><span style="color:#E1E4E8;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;P521&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		privateKey, err </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ecdsa.</span><span style="color:#79B8FF;">GenerateKey</span><span style="color:#E1E4E8;">(elliptic.</span><span style="color:#79B8FF;">P521</span><span style="color:#E1E4E8;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Unrecognized elliptic curve: </span><span style="color:#79B8FF;">%q</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, opts.ECDSACurve)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;failed to generate private key: </span><span style="color:#79B8FF;">%s</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, err)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> notBefore time.Time</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> opts.ValidFrom.</span><span style="color:#79B8FF;">IsZero</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">		notBefore </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> time.</span><span style="color:#79B8FF;">Now</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">	} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		notBefore </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> opts.ValidFrom</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> validFor time.Duration</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> opts.ValidFor </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		validFor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">365</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">24</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> time.Hour</span></span>
<span class="line"><span style="color:#E1E4E8;">	} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		validFor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> opts.ValidFor</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	notAfter </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> notBefore.</span><span style="color:#79B8FF;">Add</span><span style="color:#E1E4E8;">(validFor)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	serialNumberLimit </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">new</span><span style="color:#E1E4E8;">(big.Int).</span><span style="color:#79B8FF;">Lsh</span><span style="color:#E1E4E8;">(big.</span><span style="color:#79B8FF;">NewInt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">), </span><span style="color:#79B8FF;">128</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	serialNumber, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> rand.</span><span style="color:#79B8FF;">Int</span><span style="color:#E1E4E8;">(rand.Reader, serialNumberLimit)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;failed to generate serial number: </span><span style="color:#79B8FF;">%s</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, err)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> opts.Organization </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;organization not supplied&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	template </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> x509.Certificate{</span></span>
<span class="line"><span style="color:#E1E4E8;">		SerialNumber: serialNumber,</span></span>
<span class="line"><span style="color:#E1E4E8;">		Subject: pkix.Name{</span></span>
<span class="line"><span style="color:#E1E4E8;">			Organization: []</span><span style="color:#F97583;">string</span><span style="color:#E1E4E8;">{opts.Organization},</span></span>
<span class="line"><span style="color:#E1E4E8;">		},</span></span>
<span class="line"><span style="color:#E1E4E8;">		NotBefore: notBefore,</span></span>
<span class="line"><span style="color:#E1E4E8;">		NotAfter:  notAfter,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">		KeyUsage:              x509.KeyUsageKeyEncipherment </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> x509.KeyUsageDigitalSignature,</span></span>
<span class="line"><span style="color:#E1E4E8;">		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},</span></span>
<span class="line"><span style="color:#E1E4E8;">		BasicConstraintsValid: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> _, h </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">range</span><span style="color:#E1E4E8;"> opts.Hosts {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ip </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> net.</span><span style="color:#79B8FF;">ParseIP</span><span style="color:#E1E4E8;">(h); ip </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">			template.IPAddresses </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">append</span><span style="color:#E1E4E8;">(template.IPAddresses, ip)</span></span>
<span class="line"><span style="color:#E1E4E8;">		} </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">			template.DNSNames </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">append</span><span style="color:#E1E4E8;">(template.DNSNames, h)</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> opts.IsCA {</span></span>
<span class="line"><span style="color:#E1E4E8;">		template.IsCA </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">		template.KeyUsage </span><span style="color:#F97583;">|=</span><span style="color:#E1E4E8;"> x509.KeyUsageCertSign</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	certBytes, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> x509.</span><span style="color:#79B8FF;">CreateCertificate</span><span style="color:#E1E4E8;">(rand.Reader, </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">template, </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">template, </span><span style="color:#79B8FF;">publicKey</span><span style="color:#E1E4E8;">(privateKey), privateKey)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">, fmt.</span><span style="color:#79B8FF;">Errorf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Failed to create certificate: </span><span style="color:#79B8FF;">%s</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, err)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> certBytes, privateKey, </span><span style="color:#79B8FF;">nil</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pemBlockForKey</span><span style="color:#E1E4E8;">(priv </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;">{}) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">pem.Block {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> priv.(type) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">rsa.PrivateKey:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">pem.Block{Type: </span><span style="color:#9ECBFF;">&quot;RSA PRIVATE KEY&quot;</span><span style="color:#E1E4E8;">, Bytes: x509.</span><span style="color:#79B8FF;">MarshalPKCS1PrivateKey</span><span style="color:#E1E4E8;">(k)}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">ecdsa.PrivateKey:</span></span>
<span class="line"><span style="color:#E1E4E8;">		b, err </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> x509.</span><span style="color:#79B8FF;">MarshalECPrivateKey</span><span style="color:#E1E4E8;">(k)</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">			fmt.</span><span style="color:#79B8FF;">Fprintf</span><span style="color:#E1E4E8;">(os.Stderr, </span><span style="color:#9ECBFF;">&quot;Unable to marshal ECDSA private key: </span><span style="color:#79B8FF;">%v</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, err)</span></span>
<span class="line"><span style="color:#E1E4E8;">			os.</span><span style="color:#79B8FF;">Exit</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">pem.Block{Type: </span><span style="color:#9ECBFF;">&quot;EC PRIVATE KEY&quot;</span><span style="color:#E1E4E8;">, Bytes: b}</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">publicKey</span><span style="color:#E1E4E8;">(priv </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;">{}) </span><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;">{} {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> priv.(type) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">rsa.PrivateKey:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">k.PublicKey</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">ecdsa.PrivateKey:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">k.PublicKey</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">router</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/ecdsa</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/elliptic</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/rand</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/rsa</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/tls</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/x509</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">crypto/x509/pkix</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">encoding/pem</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">fmt</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">math/big</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">net</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">os</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">time</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">	DefaultRSABits </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CertOptions</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">struct</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// Hostnames and IPs to generate a certificate for</span></span>
<span class="line"><span style="color:#24292E;">	Hosts []</span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// Name of organization in certificate</span></span>
<span class="line"><span style="color:#24292E;">	Organization </span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// Creation date</span></span>
<span class="line"><span style="color:#24292E;">	ValidFrom time.Time</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// Duration that certificate is valid for</span></span>
<span class="line"><span style="color:#24292E;">	ValidFor time.Duration</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// whether this cert should be its own Certificate Authority</span></span>
<span class="line"><span style="color:#24292E;">	IsCA </span><span style="color:#D73A49;">bool</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// Size of RSA key to generate. Ignored if --ecdsa-curve is set</span></span>
<span class="line"><span style="color:#24292E;">	RSABits </span><span style="color:#D73A49;">int</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// ECDSA curve to use to generate a key. Valid values are P224, P256 (recommended), P384, P521</span></span>
<span class="line"><span style="color:#24292E;">	ECDSACurve </span><span style="color:#D73A49;">string</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// GeneratePEM generates a new certificate and key and returns it as PEM encoded bytes</span></span>
<span class="line"><span style="color:#6A737D;">// refers to the argo-cd: https://github.com/argoproj/argo-cd/blob/master/util/tls/tls.go</span></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GeneratePEM</span><span style="color:#24292E;">(opts CertOptions) ([]</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">, []</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">error</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">	certBytes, privateKey, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">generate</span><span style="color:#24292E;">(opts)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, err</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	certpem </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> pem.</span><span style="color:#005CC5;">EncodeToMemory</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">pem.Block{Type: </span><span style="color:#032F62;">&quot;CERTIFICATE&quot;</span><span style="color:#24292E;">, Bytes: certBytes})</span></span>
<span class="line"><span style="color:#24292E;">	keypem </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> pem.</span><span style="color:#005CC5;">EncodeToMemory</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">pemBlockForKey</span><span style="color:#24292E;">(privateKey))</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> certpem, keypem, </span><span style="color:#005CC5;">nil</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// GenerateX509KeyPair generates a X509 key pair</span></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GenerateX509KeyPair</span><span style="color:#24292E;">(opts CertOptions) (</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">tls.Certificate, </span><span style="color:#D73A49;">error</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">	certpem, keypem, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">GeneratePEM</span><span style="color:#24292E;">(opts)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, err</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	cert, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> tls.</span><span style="color:#005CC5;">X509KeyPair</span><span style="color:#24292E;">(certpem, keypem)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, err</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">cert, </span><span style="color:#005CC5;">nil</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">generate</span><span style="color:#24292E;">(opts CertOptions) ([]</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">, crypto.PrivateKey, </span><span style="color:#D73A49;">error</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(opts.Hosts) </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;hosts not supplied&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> privateKey crypto.PrivateKey</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">error</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> opts.ECDSACurve {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		rsaBits </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> DefaultRSABits</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> opts.RSABits </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">			rsaBits </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> opts.RSABits</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">		privateKey, err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rsa.</span><span style="color:#005CC5;">GenerateKey</span><span style="color:#24292E;">(rand.Reader, rsaBits)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;P224&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		privateKey, err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ecdsa.</span><span style="color:#005CC5;">GenerateKey</span><span style="color:#24292E;">(elliptic.</span><span style="color:#005CC5;">P224</span><span style="color:#24292E;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;P256&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		privateKey, err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ecdsa.</span><span style="color:#005CC5;">GenerateKey</span><span style="color:#24292E;">(elliptic.</span><span style="color:#005CC5;">P256</span><span style="color:#24292E;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;P384&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		privateKey, err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ecdsa.</span><span style="color:#005CC5;">GenerateKey</span><span style="color:#24292E;">(elliptic.</span><span style="color:#005CC5;">P384</span><span style="color:#24292E;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;P521&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		privateKey, err </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ecdsa.</span><span style="color:#005CC5;">GenerateKey</span><span style="color:#24292E;">(elliptic.</span><span style="color:#005CC5;">P521</span><span style="color:#24292E;">(), rand.Reader)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Unrecognized elliptic curve: </span><span style="color:#005CC5;">%q</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, opts.ECDSACurve)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;failed to generate private key: </span><span style="color:#005CC5;">%s</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, err)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> notBefore time.Time</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> opts.ValidFrom.</span><span style="color:#005CC5;">IsZero</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">		notBefore </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> time.</span><span style="color:#005CC5;">Now</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">	} </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		notBefore </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> opts.ValidFrom</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> validFor time.Duration</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> opts.ValidFor </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		validFor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">365</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">24</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> time.Hour</span></span>
<span class="line"><span style="color:#24292E;">	} </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		validFor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> opts.ValidFor</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	notAfter </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> notBefore.</span><span style="color:#005CC5;">Add</span><span style="color:#24292E;">(validFor)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	serialNumberLimit </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">new</span><span style="color:#24292E;">(big.Int).</span><span style="color:#005CC5;">Lsh</span><span style="color:#24292E;">(big.</span><span style="color:#005CC5;">NewInt</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">), </span><span style="color:#005CC5;">128</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	serialNumber, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> rand.</span><span style="color:#005CC5;">Int</span><span style="color:#24292E;">(rand.Reader, serialNumberLimit)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;failed to generate serial number: </span><span style="color:#005CC5;">%s</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, err)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> opts.Organization </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;organization not supplied&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	template </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> x509.Certificate{</span></span>
<span class="line"><span style="color:#24292E;">		SerialNumber: serialNumber,</span></span>
<span class="line"><span style="color:#24292E;">		Subject: pkix.Name{</span></span>
<span class="line"><span style="color:#24292E;">			Organization: []</span><span style="color:#D73A49;">string</span><span style="color:#24292E;">{opts.Organization},</span></span>
<span class="line"><span style="color:#24292E;">		},</span></span>
<span class="line"><span style="color:#24292E;">		NotBefore: notBefore,</span></span>
<span class="line"><span style="color:#24292E;">		NotAfter:  notAfter,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">		KeyUsage:              x509.KeyUsageKeyEncipherment </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> x509.KeyUsageDigitalSignature,</span></span>
<span class="line"><span style="color:#24292E;">		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},</span></span>
<span class="line"><span style="color:#24292E;">		BasicConstraintsValid: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> _, h </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">range</span><span style="color:#24292E;"> opts.Hosts {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ip </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> net.</span><span style="color:#005CC5;">ParseIP</span><span style="color:#24292E;">(h); ip </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">			template.IPAddresses </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">append</span><span style="color:#24292E;">(template.IPAddresses, ip)</span></span>
<span class="line"><span style="color:#24292E;">		} </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">			template.DNSNames </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">append</span><span style="color:#24292E;">(template.DNSNames, h)</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> opts.IsCA {</span></span>
<span class="line"><span style="color:#24292E;">		template.IsCA </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">		template.KeyUsage </span><span style="color:#D73A49;">|=</span><span style="color:#24292E;"> x509.KeyUsageCertSign</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	certBytes, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> x509.</span><span style="color:#005CC5;">CreateCertificate</span><span style="color:#24292E;">(rand.Reader, </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">template, </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">template, </span><span style="color:#005CC5;">publicKey</span><span style="color:#24292E;">(privateKey), privateKey)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">, fmt.</span><span style="color:#005CC5;">Errorf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Failed to create certificate: </span><span style="color:#005CC5;">%s</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, err)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> certBytes, privateKey, </span><span style="color:#005CC5;">nil</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pemBlockForKey</span><span style="color:#24292E;">(priv </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;">{}) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">pem.Block {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> priv.(type) {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">rsa.PrivateKey:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">pem.Block{Type: </span><span style="color:#032F62;">&quot;RSA PRIVATE KEY&quot;</span><span style="color:#24292E;">, Bytes: x509.</span><span style="color:#005CC5;">MarshalPKCS1PrivateKey</span><span style="color:#24292E;">(k)}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">ecdsa.PrivateKey:</span></span>
<span class="line"><span style="color:#24292E;">		b, err </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> x509.</span><span style="color:#005CC5;">MarshalECPrivateKey</span><span style="color:#24292E;">(k)</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> err </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">			fmt.</span><span style="color:#005CC5;">Fprintf</span><span style="color:#24292E;">(os.Stderr, </span><span style="color:#032F62;">&quot;Unable to marshal ECDSA private key: </span><span style="color:#005CC5;">%v</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, err)</span></span>
<span class="line"><span style="color:#24292E;">			os.</span><span style="color:#005CC5;">Exit</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">pem.Block{Type: </span><span style="color:#032F62;">&quot;EC PRIVATE KEY&quot;</span><span style="color:#24292E;">, Bytes: b}</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">publicKey</span><span style="color:#24292E;">(priv </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;">{}) </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;">{} {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> priv.(type) {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">rsa.PrivateKey:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">k.PublicKey</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">ecdsa.PrivateKey:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">k.PublicKey</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>调用上述代码中的<code>GeneratePEM(opts CertOptions) ([]byte, []byte, error)</code>方法即可生成自签名<code>TLS</code>证书，其返回值分别对应证书文件和密钥文件。</p><p>其简单调用如下：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// GenerateTLSCert generates the self-signed certs.</span></span>
<span class="line"><span style="color:#6A737D;">// return certPem, keyPem, err</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GenerateTLSCert</span><span style="color:#E1E4E8;">() ([]</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">, []</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">error</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> router.</span><span style="color:#79B8FF;">GeneratePEM</span><span style="color:#E1E4E8;">(router.CertOptions{</span></span>
<span class="line"><span style="color:#E1E4E8;">		Hosts:        []</span><span style="color:#F97583;">string</span><span style="color:#E1E4E8;">{</span><span style="color:#9ECBFF;">&quot;localhost&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">		Organization: </span><span style="color:#9ECBFF;">&quot;GroupName&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		IsCA:         </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// GenerateTLSCert generates the self-signed certs.</span></span>
<span class="line"><span style="color:#6A737D;">// return certPem, keyPem, err</span></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GenerateTLSCert</span><span style="color:#24292E;">() ([]</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">, []</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">error</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> router.</span><span style="color:#005CC5;">GeneratePEM</span><span style="color:#24292E;">(router.CertOptions{</span></span>
<span class="line"><span style="color:#24292E;">		Hosts:        []</span><span style="color:#D73A49;">string</span><span style="color:#24292E;">{</span><span style="color:#032F62;">&quot;localhost&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">		Organization: </span><span style="color:#032F62;">&quot;GroupName&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		IsCA:         </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>生成自签名证书之后，可根据项目需要将其进行持久化处理等操作。</p></div></div></main><footer class="VPDocFooter" data-v-dcd5a9aa data-v-92573369><!--[--><!--]--><!----><!----></footer><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-329f128b data-v-2dac7930><div class="container" data-v-2dac7930><p class="message" data-v-2dac7930>~~~我是有底线的~~~</p><p class="copyright" data-v-2dac7930>MIT Licensed | <a target="_blank" href="https://theme.sugarat.top/"> ZQ-XU </a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"zh_cloud-native_kubernetes_crd-operator.md\":\"30571594\",\"zh_cloud-native_kubernetes_installation_cni-calico.md\":\"3dafa730\",\"zh_cloud-native_kubernetes_installation_csi-nfs.md\":\"48e17aec\",\"zh_cloud-native_kubernetes_installation.md\":\"d3088e20\",\"zh_cloud-native_kubernetes_installation_faq.md\":\"9c1b2f56\",\"zh_cloud-native_kubernetes_installation_minikube.md\":\"25cbf320\",\"zh_cloud-native_kubernetes_operation.md\":\"abbb7620\",\"zh_cloud-native_kubernetes_overview.md\":\"7af28938\",\"zh_cloud-native_kubernetes_practice.md\":\"641b0571\",\"zh_cloud-native_kubernetes_practice_dns-delay.md\":\"888a1fda\",\"zh_cloud-native_kubernetes_practice_endpoints-skip-healthcheck.md\":\"4b8f827f\",\"zh_cloud-native_kubernetes_installation_cni-cilium-ebpf.md\":\"abaeb0f4\",\"zh_cloud-native_kubernetes_installation_csi-ceph.md\":\"1f59d0ed\",\"zh_cloud-native_kubernetes_installation_csi-localpath.md\":\"7840cd04\",\"zh_open-source_tekton_installation.md\":\"92b3820b\",\"zh_coding_golang_design-patterns.md\":\"ad322675\",\"zh_coding_golang_index.md\":\"6a5ba2bc\",\"zh_coding_golang_practice.md\":\"d4174204\",\"zh_coding_golang_practice_jwt.md\":\"a41c9b7a\",\"zh_coding_golang_practice_time-json.md\":\"9456dbb9\",\"zh_coding_golang_reference.md\":\"b4042ba3\",\"zh_coding_golang_standards.md\":\"42f34ffa\",\"zh_coding_vue-vite_command.md\":\"d5654b39\",\"zh_coding_vue-vite_docs-build.md\":\"afabe0af\",\"zh_coding_vue-vite_gh-pages.md\":\"05b02225\",\"zh_coding_vue-vite_reference.md\":\"f7f9f20e\",\"zh_open-source_tekton_basic-usage.md\":\"db18383c\",\"zh_open-source_tekton_index.md\":\"a9f57603\",\"zh_more_resource-share.md\":\"4bb07dfd\",\"zh_cloud-native_kubernetes_reference.md\":\"3e31b6c7\",\"zh_coding_golang_practice_float.md\":\"5cfe68ad\",\"zh_tools_kubeadm.md\":\"46419964\",\"zh_tools_kubectl.md\":\"de460253\",\"zh_tools_nfs-client.md\":\"b14e1cf5\",\"zh_tools_nfs-server.md\":\"6c5cdb4e\",\"zh_cloud-native_kubernetes_configuration.md\":\"4d64fa7a\",\"index.md\":\"72fcafa4\",\"zh_coding_vue-vite_index.md\":\"cb7b96c0\",\"zh_tools_docker.md\":\"72b5ce51\",\"zh_tools_git.md\":\"a8b000d9\",\"zh_cloud-native_kubernetes_installation_kubernetes-cluster-ha.md\":\"fb4116c1\",\"zh_cloud-native_kubernetes_index.md\":\"231df50a\",\"zh_coding_golang_practice_tls.md\":\"f9c8be2f\",\"zh_tools_harbor.md\":\"5b4868e2\",\"zh_tools_helm-chartmuseum.md\":\"9aef0a1c\",\"zh_tools_helm-push.md\":\"eeb45a35\",\"zh_tools_helm.md\":\"3bf474a1\",\"zh_tools_index.md\":\"21d60a24\",\"zh_cloud-native_kubernetes_installation_kubernetes-cluster.md\":\"fe0844ed\",\"zh_more_aboutme.md\":\"013874c7\",\"zh_open-source_vitess_index.md\":\"c390f5a7\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cmn-Hans\",\"dir\":\"ltr\",\"title\":\"ZQ-XU\",\"description\":\"ZQ-XU的个人博客\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/zh/more/aboutme\",\"meta\":{\"title\":\"个人简介\",\"description\":\"个人基本信息\",\"cover\":\"/images/avatar.png\",\"hiddenCover\":true,\"readingTime\":false,\"date\":\"2023-02-16 16:00:00\",\"top\":1,\"tag\":[]}},{\"route\":\"/zh/more/resource-share\",\"meta\":{\"title\":\"资源分享\",\"description\":\"个人认为比较实用的资源分享\",\"cover\":\"/images/more/share-logo.png\",\"hiddenCover\":true,\"readingTime\":false,\"date\":\"2023-02-15 16:00:00\",\"sticky\":1,\"top\":2,\"tag\":[]}},{\"route\":\"/zh/tools/docker\",\"meta\":{\"date\":\"2022-11-30 16:00:00\",\"title\":\"Docker\",\"tag\":[],\"description\":\"- Docker官方文档\\n- Docker实践可参考Docker-从入门到实践\\n 安装Docker\\n 脚本安装\\n```bash\\ncurl -fsSL https://get.docker.com | \",\"cover\":\"\"}},{\"route\":\"/zh/tools/git\",\"meta\":{\"date\":\"2022-11-30 16:00:00\",\"title\":\"Git工具\",\"tag\":[],\"description\":\"以下两个用于学习Git的链接得益于我曾经带过的实习生的分享：\\n- GIt使用教程\\n- Git使用Demo\",\"cover\":\"\"}},{\"route\":\"/zh/tools/harbor\",\"meta\":{\"date\":\"2022-11-29 16:00:00\",\"title\":\"Harbor仓库\",\"tag\":[],\"description\":\"Harbor仓库常用来作为Docker镜像的私有镜像仓库使用，本文使用容器的方式来进行本地搭建。\\n 安装Harbor\\n 安装环境\\n- 安装机器：Linux服务器，本文中使用服务器的IP为`192.16\",\"cover\":\"\"}},{\"route\":\"/zh/tools/helm-chartmuseum\",\"meta\":{\"date\":\"2022-11-25 16:00:00\",\"title\":\"Helm仓库\",\"tag\":[],\"description\":\"Helm仓库是用来存放Chart包的平台。\\n`Chartmuseum`是常用来作为Helm仓库的工具，本文使用容器的方式来进行本地搭建。\\n 安装Helm仓库\\n 环境准备\\n- 安装机器：Linux系统服\",\"cover\":\"\"}},{\"route\":\"/zh/tools/helm-push\",\"meta\":{\"date\":\"2022-11-24 16:00:00\",\"title\":\"Helm-Push插件\",\"tag\":[],\"description\":\"Helm Push插件本质上是一个二进制可执行文件,主要用于将Chart包推送到Chart仓库中。\\n 安装Helm Push插件\\n 获取Helm插件路径\\n```bash\\n 通过指令查看helm环境变量\",\"cover\":\"\"}},{\"route\":\"/zh/tools/helm\",\"meta\":{\"date\":\"2022-11-26 16:00:00\",\"title\":\"Helm工具\",\"tag\":[],\"description\":\"Helm工具本质上是一个二进制可执行文件，主要用于在Kubernetes环境中安装`Chart包`。\\n 安装Helm工具\\n此处选择的Helm工具的`v3.7.1`版本，更多Helm版本可参考 Helm\",\"cover\":\"\"}},{\"route\":\"/zh/tools/index\",\"meta\":{\"description\":\"常用工具安装及使用\",\"cover\":\"/images/tools/tools-logo.png\",\"hiddenCover\":true,\"title\":\"常用工具\",\"readingTime\":false,\"date\":\"2023-01-01 16:00:00\",\"tag\":[\"常用工具\",\"常用工具\"],\"categories\":[\"常用工具\"]}},{\"route\":\"/zh/tools/kubeadm\",\"meta\":{\"date\":\"2022-11-28 16:00:00\",\"title\":\"Kubeadm工具\",\"tag\":[],\"description\":\"Kubeadm工具本质上是一个二进制文件，主要用于安装Kubernetes集群。\\n 参数\\n --v\\n可在指令中添加`--v=5`以查看详细的执行日志。\\n --node-name\\n可在指令中添加`--n\",\"cover\":\"\"}},{\"route\":\"/zh/tools/kubectl\",\"meta\":{\"date\":\"2022-11-27 16:00:00\",\"title\":\"Kubectl工具\",\"tag\":[],\"description\":\"Kubectl工具本质上是一个二进制文件，主要用于操作Kubernetes环境。\",\"cover\":\"\"}},{\"route\":\"/zh/tools/nfs-client\",\"meta\":{\"date\":\"2022-11-22 16:00:00\",\"title\":\"NFS Client\",\"tag\":[],\"description\":\" 概览\\nNFS Client可以挂载NFS Server管理的共享目录，使得多台服务器可以风筒管理共享目录，NFS支持多点挂载，即在多个服务器上同时挂载同一个共享目录。\\n 环境说明\\n- NFS Ser\",\"cover\":\"\"}},{\"route\":\"/zh/tools/nfs-server\",\"meta\":{\"date\":\"2022-11-23 16:00:00\",\"title\":\"NFS Server\",\"tag\":[],\"description\":\" 概览\\nNFS Server管理一个或多个文件目录，使得这些文件目录可以被挂载到多台服务器上，成为多台服务器共享的文件目录。\\n 环境说明\\n通过如下指令查看系统环境：\\n```\\n$ cat /etc/re\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/configuration\",\"meta\":{\"date\":\"2022-12-28 16:00:00\",\"recommend\":4,\"title\":\"Kubernetes常用配置\",\"tag\":[],\"description\":\" 增加节点\\n创建集群时控制台打印信息中含有新增节点的指令，可按照该指令增加节点至集群。\\n若遗失该指令，或`token`/`certificate-key`等参数过期，可参考如下方式重新生成指令：\\n- \",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/crd-operator\",\"meta\":{\"recommend\":6,\"title\":\"CRD && Operator\",\"date\":\"2023-04-03 02:27:44\",\"tag\":[],\"description\":\"`CRD && Operator`是指使用CRD来定义资源属性并由Operator服务组件进行解析和管理。\\n CRD\\nCRD(Custom Resource Definition)是 Kubernet\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/index\",\"meta\":{\"description\":\"Kubernetes学习、安装和实践\",\"cover\":\"/images/cloud-native/kubernetes/kubernetes-stacked-all-blue-color.svg\",\"hiddenCover\":true,\"title\":\"Kubernetes\",\"readingTime\":false,\"date\":\"2023-01-30 16:00:00\",\"tag\":[\"Kubernetes\",\"云原生\",\"容器编排\"],\"tags\":[\"容器编排\"],\"categories\":[\"云原生\"],\"top\":3,\"recommend\":1}},{\"route\":\"/zh/cloud-native/kubernetes/installation\",\"meta\":{\"recommend\":3,\"title\":\"Kubernetes安装\",\"date\":\"2023-04-03 02:27:44\",\"tag\":[],\"description\":\" Kubernetes安装\\n- 安装Minikube集群： 单节点Kubernetes环境，常用于学习使用或作为开发环境。\\n- 安装Kubernetes集群：一个Master节点和若干Worker节点\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/operation\",\"meta\":{\"recommend\":5,\"title\":\"Kubernetes常用操作\",\"date\":\"2023-04-03 02:27:44\",\"tag\":[],\"description\":\" 查看Kubelet日志\\n```bash\\njournalctl -xefu kubelet\\n```\\n 强行删除Pod\\n```bash\\nkubectl -n $namespace delete pod \",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/overview\",\"meta\":{\"sticky\":999,\"date\":\"2022-12-30 16:00:00\",\"recommend\":2,\"title\":\"Kubernetes基础\",\"tag\":[],\"description\":\" 概览\\nKubernetes是:\\n- Google基于Borg 开源的容器编排引擎，提供了面向应用的容器部署和管理系统。\\n- CNCF(Cloud Native Computing Foundatio\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/practice\",\"meta\":{\"recommend\":7,\"title\":\"Kubernetes实践笔记\",\"date\":\"2023-04-03 02:27:44\",\"tag\":[],\"description\":\"- StatefulSet资源的Pod域名解析延迟问题验证\\n- 跳过健康检查为Pod分配Endpoints\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/reference\",\"meta\":{\"recommend\":8,\"title\":\"Kubernetes参考\",\"date\":\"2023-04-03 02:27:44\",\"tag\":[],\"description\":\" 学习资料\\n- Kubernetes基础学习资料下载：32深入剖析Kubernetes.zip\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/design-patterns\",\"meta\":{\"sticky\":998,\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":4,\"title\":\"Golang设计模式\",\"date\":\"2023-03-23 12:57:34\",\"description\":\"代码的高质量体现在功能性、可靠性、扩展性、可读性等多个方面。\\n基于Go语言本身简洁的特点，实现业务功能是一件比较简单的事情。\\n但在持续增长的业务驱动下，想要实现需求的快速迭代并保证代码的高质量，就需要\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/index\",\"meta\":{\"description\":\"Golang编程代码规范、设计模式、开源项目和相关技术栈\",\"cover\":\"/images/coding/golang/golang-logo.png\",\"hiddenCover\":true,\"title\":\"Golang\",\"readingTime\":false,\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"top\":4,\"recommend\":1,\"date\":\"2023-05-22 07:57:28\"}},{\"route\":\"/zh/coding/golang/practice\",\"meta\":{\"date\":\"2022-12-26 16:00:00\",\"recommend\":5,\"title\":\"Golang实践\",\"tag\":[],\"description\":\"- Float类型处理\\n- TLS的Golang应用\\n- JWT鉴权\\n- 自定义时间类型的JSON字符\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/reference\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":2,\"title\":\"Golang参考资源\",\"date\":\"2023-10-13 09:53:25\",\"description\":\" Golang学习资料\\n- Go语言圣经：Go语言入门书籍；\\n- Go语言高级编程：Go语言进阶书籍；\\n- Go语言定制指南：深入学习Go语言语法树结构；\\n- Go 学习之路：Go语言学习资料整理；\\n\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/standards\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":3,\"title\":\"Golang编码规范\",\"date\":\"2023-03-23 12:57:34\",\"description\":\"1. 单个方法代码量不超过50行；\\n2. 单个方法的传入参数不超过5个；\\n3. 单个方法实现单一功能，具体功能细节需要单独封装；\\n4. 方法中可以有else if,但是尽量不要有else；\\n5. 单个\",\"cover\":\"\"}},{\"route\":\"/zh/coding/vue-vite/command\",\"meta\":{\"tags\":[\"Vue\",\"Vite\"],\"categories\":[\"Web\"],\"recommend\":5,\"title\":\"Vite/Vue常用指令\",\"date\":\"2023-03-15 09:46:20\",\"tag\":[\"Web\",\"Vue\",\"Vite\"],\"description\":\" 升级指定依赖\\n使用`pnpm`工具升级指定依赖到最新版本(以依赖项`@sugarat/theme`为例)：\\n```bash\\npnpm up @sugarat/theme\\n```\",\"cover\":\"\"}},{\"route\":\"/zh/coding/vue-vite/docs-build\",\"meta\":{\"sticky\":996,\"date\":\"2022-08-29 16:00:00\",\"tag\":[\"docs\",\"Web\",\"Vue\",\"Vite\"],\"tags\":[\"Vue\",\"Vite\"],\"categories\":[\"Web\"],\"recommend\":3,\"title\":\"Web示例/文档/博客构建\",\"description\":\"以`Vue`或`Vite`为基础，可以构建Web示例/项目文档，并部署到Github Pages等多种平台。\\nWeb项目可以打包好的静态文件（接口以`mock`代替）作为Web示例。\\n文档/博客如果是\",\"cover\":\"\"}},{\"route\":\"/zh/coding/vue-vite/gh-pages\",\"meta\":{\"sticky\":995,\"date\":\"2022-08-28 16:00:00\",\"tag\":[\"docs\",\"Web\",\"Vue\",\"Vite\"],\"tags\":[\"Vue\",\"Vite\"],\"categories\":[\"Web\"],\"recommend\":4,\"title\":\"Github Pages部署\",\"description\":\"要将项目的Web示例/文档部署到Github Pages，主要需要完成以下两步：\\n- 项目打包配置：项目内部配置，实现本地手动/`Github Action`自动的打包推送；\\n- Github配置：在\",\"cover\":\"\"}},{\"route\":\"/zh/coding/vue-vite/index\",\"meta\":{\"description\":\"Vue编程相关笔记\",\"cover\":\"/images/coding/vue/vue-logo.svg\",\"hiddenCover\":true,\"title\":\"Vue & Vite\",\"readingTime\":false,\"date\":\"2023-01-28 16:00:00\",\"tags\":[\"docs\",\"Vue\",\"Vite\"],\"categories\":[\"Web\"],\"top\":5,\"recommend\":1,\"tag\":[\"Web\",\"docs\",\"Vue\",\"Vite\"]}},{\"route\":\"/zh/coding/vue-vite/reference\",\"meta\":{\"sticky\":997,\"date\":\"2022-08-30 16:00:00\",\"tags\":[\"Vue\",\"Vite\"],\"categories\":[\"Web\"],\"recommend\":2,\"title\":\"Vue & Vite参考资源\",\"tag\":[\"Web\",\"Vue\",\"Vite\"],\"description\":\"如果是新手入门，建议大概了解`Vue`的基础之后，从一款开箱即用的Vue框架开始实践。\\n在实践中学习，比较容易找到感觉和成就感，继而再深入学习相应的原理，效率或许会高很多。\\n Vue基础\\n- Vue3\",\"cover\":\"\"}},{\"route\":\"/zh/open-source/tekton/basic-usage\",\"meta\":{\"date\":\"2022-10-29 16:00:00\",\"tag\":[\"Tekton\",\"DevOps\",\"Kubernetes\"],\"tags\":[\"Kubernetes\"],\"categories\":[\"DevOps\"],\"title\":\"Tekton基本使用\",\"description\":\" 概览\\nTekton 是用于构建 CI/CD 的云原生解决方案，主要在 Kubernetes 集群上的安装和运行。开发者可以通过Tekton来定义自己的CI流程，从而实现从项目构建到项目发布的全流程。\",\"cover\":\"\"}},{\"route\":\"/zh/open-source/tekton/index\",\"meta\":{\"description\":\"Kubernetes官方推荐的CI工具，适用于DevOps基础\",\"cover\":\"/images/open-source/tekton/tekton-horizontal-color.png\",\"hiddenCover\":true,\"date\":\"2023-01-14 16:00:00\",\"readingTime\":false,\"tag\":[\"Tekton\",\"Open Source\",\"Kubernetes\",\"CNCF\",\"DevOps\"],\"tags\":[\"Kubernetes\",\"CNCF\",\"DevOps\"],\"categories\":[\"Open Source\"],\"title\":\"Tekton\"}},{\"route\":\"/zh/open-source/tekton/installation\",\"meta\":{\"date\":\"2022-10-30 16:00:00\",\"tag\":[\"Tekton\",\"DevOps\",\"Kubernetes\"],\"tags\":[\"Kubernetes\"],\"categories\":[\"DevOps\"],\"title\":\"Tekton安装\",\"description\":\" 概览\\nTekton 是Kubernetes环境中常用的 CI/CD 工具，其主要提供了流水线功能，便于开发者进行项目打包。\\nTekton环境主要包括以下内容：\\n- tekton-pipeline:\\n\",\"cover\":\"\"}},{\"route\":\"/zh/open-source/vitess/index\",\"meta\":{\"description\":\"Vitess是一个用于部署，扩展和管理大型开源数据库实例集群的数据库解决方案。通俗点说，就是在云环境下对大型数据库及数据库集群进行分库分表并提供可靠性处理的方案。\",\"cover\":\"/images/open-source/vitess/vitess-horizontal-color.svg\",\"hiddenCover\":true,\"date\":\"2021-11-09 16:00:00\",\"tag\":[\"Vitess\",\"Open Source\",\"Kubernetes\",\"CNCF\"],\"tags\":[\"Kubernetes\",\"CNCF\"],\"categories\":[\"Open Source\"],\"title\":\"Vitess\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/cni-calico\",\"meta\":{\"date\":\"2022-12-24 16:00:00\",\"title\":\"Calico CNI安装\",\"tag\":[],\"description\":\"\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/cni-cilium-ebpf\",\"meta\":{\"date\":\"2022-12-23 16:00:00\",\"title\":\"Cilium/EBPF CNI安装\",\"tag\":[],\"description\":\"\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/csi-ceph\",\"meta\":{\"date\":\"2022-12-26 16:00:00\",\"title\":\"Ceph CSI安装\",\"tag\":[],\"description\":\"\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/csi-localpath\",\"meta\":{\"date\":\"2022-12-27 16:00:00\",\"title\":\"LocalPath CSI安装\",\"tag\":[],\"description\":\"在Kubernetes环境中，如果想使用本机路径作为为CSI提供的PV存在，则需要提供相应的Provisioner来为本机路径动态分配PV.\\nKubernetes官方提供了sig-storage-lo\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/csi-nfs\",\"meta\":{\"date\":\"2022-12-25 16:00:00\",\"title\":\"NFS CSI安装\",\"tag\":[],\"description\":\"\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/faq\",\"meta\":{\"date\":\"2022-12-22 16:00:00\",\"title\":\"FAQ\",\"tag\":[],\"description\":\" 安装Kubernetes遇到CNI冲突问题\\n使用如下指令移除CNI后重新安装：\\n```\\nifconfig cni0 down\\nip link delete cni0\\n```\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/kubernetes-cluster-ha\",\"meta\":{\"date\":\"2022-12-28 16:00:00\",\"title\":\"Kubernetes高可用集群安装\",\"tag\":[],\"description\":\"高可用K8S集群是指K8S的Master节点个数不少于3个，K8S管理面每个组件副本数不少于3个的Kubernetes集群。\\n 整体架构\\n 环境信息\\n- Master节点：\\n    - 192.168\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/kubernetes-cluster\",\"meta\":{\"date\":\"2022-12-29 16:00:00\",\"title\":\"Kubernetes集群安装\",\"tag\":[],\"description\":\"Kubernetes集群分为单Master节点集群和高可用集群:\\n- 单Master节点集群：一个Master节点和若干个Worker节点组成，常用于开发或测试环境；\\n- 高可用集群：至少3个Mast\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/installation/minikube\",\"meta\":{\"date\":\"2022-12-30 16:00:00\",\"title\":\"Minikube集群安装\",\"tag\":[],\"description\":\"Minikube是单节点的Kubernetes环境，常用于学习使用或作为开发环境。\\n 搭建环境\\n服务器信息和基础环境如下：\\n- OS: Linux\\n- Kubectl: v1.22.3\\n- Minik\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/practice/dns-delay\",\"meta\":{\"date\":\"2022-10-30 16:00:00\",\"title\":\"StatefulSet资源的Pod域名解析延迟问题验证\",\"tag\":[],\"description\":\"在k8s环境中，服务地址常常以域名表示，需要k8s环境中DNS进行解析。\\nK8S环境中的DNS通常使用CoreDNS，其存在30s缓存。\\n因此，新创建的StatefulSet资源生成的Pod实例对应的\",\"cover\":\"\"}},{\"route\":\"/zh/cloud-native/kubernetes/practice/endpoints-skip-healthcheck\",\"meta\":{\"date\":\"2022-10-29 16:00:00\",\"title\":\"跳过健康检查为Pod分配Endpoints\",\"tag\":[],\"description\":\"Kubernetes中的Pod通常会绑定Service资源，Kubernetes通过Service资源来做网络转发、负载均衡等网络操作，使得用户无需知道Pod的实际ip，对Service资源发起的网络\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/practice/float\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":1,\"title\":\"Float类型处理\",\"date\":\"2023-10-16 17:05:54\",\"description\":\"使用`Golang`原生库进行`Float`类型数据处理的时候，常常会遇到数据失真的问题。\\n以下引用Go语言浮点类型（小数类型）简要介绍一下`Golang`中的`Float`类型：\\n\\n> 这些浮点数类\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/practice/jwt\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":3,\"title\":\"JWT鉴权\",\"date\":\"2023-04-20 09:14:48\",\"description\":\" JWT定义\\nJSON Web Token (JWT) 是一个开放标准 ( RFC 7519 )，它定义了一种紧凑且自包含的方式，用于在各方之间以 JSON 对象的形式安全传输信息。此信息可以验证和信\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/practice/time-json\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":4,\"title\":\"自定义时间类型的JSON字符\",\"date\":\"2023-10-18 19:21:08\",\"description\":\"Go语言中，原生库`time.Time`表示的时间类型在`json`序列化或反序列化时对应着固定格式的字符序列，因此，如果希望使用特定格式的字符序列或者使用时间戳等形式，则可以通过自定义类型，并使其继\",\"cover\":\"\"}},{\"route\":\"/zh/coding/golang/practice/tls\",\"meta\":{\"tag\":[\"Golang\",\"Golang\"],\"categories\":[\"Golang\"],\"recommend\":2,\"title\":\"TLS的Golang应用\",\"date\":\"2023-04-13 06:03:30\",\"description\":\" TLS简介\\n`TLS`通常是指传输层安全(Transport Layer Security),是一种广泛使用的安全性协议。其由`Netscape`公司开发的安全套接字层(Secure Socket \",\"cover\":\"\"}}],\"author\":\"鸢涯\",\"recommend\":{\"showSelf\":true},\"friend\":[{\"nickname\":\"粥里有勺糖\",\"des\":\"你的指尖用于改变世界的力量\",\"avatar\":\"https://img.cdn.sugarat.top/mdImg/MTY3NDk5NTE2NzAzMA==674995167030\",\"url\":\"https://sugarat.top\"},{\"nickname\":\"Vitepress\",\"des\":\"Vite & Vue Powered Static Site Generator\",\"avatar\":\"https://img.cdn.sugarat.top/mdImg/MTY3NDk5NTI2NzY1Ng==674995267656\",\"url\":\"https://vitepress.vuejs.org/\"}],\"popover\":{\"title\":\"公告\",\"duration\":-1,\"body\":[{\"type\":\"text\",\"content\":\"👇 微信 👇 欢迎大家私信交流\"},{\"type\":\"image\",\"src\":\"/images/more/wechat-qrcode.png\"}]},\"search\":\"pagefind\",\"mermaid\":true},\"sidebar\":[{\"text\":\"\",\"items\":[]}],\"logo\":\"/logo.png\",\"outline\":[2,6],\"nav\":[{\"text\":\"开源杂记\",\"items\":[{\"text\":\"Tekton -- 云原生CI工具\",\"link\":\"/zh/open-source/tekton/index\"},{\"text\":\"Vitess -- 数据库分库分表解决方案\",\"link\":\"/zh/open-source/vitess/index\"}]},{\"text\":\"云原生\",\"items\":[{\"text\":\"Kubernetes\",\"items\":[{\"text\":\"Kubernetes基础\",\"link\":\"/zh/cloud-native/kubernetes/overview\"},{\"text\":\"Kubernetes安装\",\"link\":\"/zh/cloud-native/kubernetes/installation\"},{\"text\":\"Kubernetes常用配置\",\"link\":\"/zh/cloud-native/kubernetes/configuration\"},{\"text\":\"Kubernetes常用操作\",\"link\":\"/zh/cloud-native/kubernetes/operation\"},{\"text\":\"CRD && Operator\",\"link\":\"/zh/cloud-native/kubernetes/crd-operator\"},{\"text\":\"Kubernetes实践\",\"link\":\"/zh/cloud-native/kubernetes/practice\"},{\"text\":\"Kubernetes参考\",\"link\":\"/zh/cloud-native/kubernetes/reference\"}]}]},{\"text\":\"手撕代码\",\"items\":[{\"text\":\"Golang\",\"items\":[{\"text\":\"Golang参考资源\",\"link\":\"/zh/coding/golang/reference\"},{\"text\":\"Golang编码规范\",\"link\":\"/zh/coding/golang/standards\"},{\"text\":\"Golang设计模式\",\"link\":\"/zh/coding/golang/design-patterns\"},{\"text\":\"Golang实践\",\"link\":\"/zh/coding/golang/practice\"}]},{\"text\":\"Vue & Vite\",\"items\":[{\"text\":\"Vue/Vite参考资源\",\"link\":\"/zh/coding/vue-vite/reference\"},{\"text\":\"Web示例/文档/博客构建\",\"link\":\"/zh/coding/vue-vite/docs-build\"},{\"text\":\"Github Pages部署\",\"link\":\"/zh/coding/vue-vite/gh-pages\"},{\"text\":\"Vue/Vite常用指令\",\"link\":\"/zh/coding/vue-vite/command\"}]}]},{\"text\":\"常用工具\",\"items\":[{\"text\":\"Git工具\",\"link\":\"/zh/tools/git\"},{\"text\":\"Docker\",\"link\":\"/zh/tools/docker\"},{\"text\":\"Harbor镜像仓库\",\"link\":\"/zh/tools/harbor\"},{\"text\":\"Kubeadm工具\",\"link\":\"/zh/tools/kubeadm\"},{\"text\":\"Kubectl工具\",\"link\":\"/zh/tools/kubectl\"},{\"text\":\"Helm工具\",\"link\":\"/zh/tools/helm\"},{\"text\":\"Helm-Push插件\",\"link\":\"/zh/tools/helm-push\"},{\"text\":\"Helm仓库\",\"link\":\"/zh/tools/helm-chartmuseum\"},{\"text\":\"NFS Server\",\"link\":\"/zh/tools/nfs-server\"},{\"text\":\"NFS Client\",\"link\":\"/zh/tools/nfs-client\"}]},{\"text\":\"了解更多\",\"items\":[{\"text\":\"个人简介\",\"link\":\"/zh/more/aboutme\"},{\"text\":\"资源分享\",\"link\":\"/zh/more/resource-share\"},{\"text\":\"DockerHub\",\"link\":\"https://hub.docker.com/u/zqxu1993\"}]}],\"lastUpdatedText\":\"上次更新于\",\"footer\":{\"message\":\"~~~我是有底线的~~~\",\"copyright\":\"MIT Licensed | <a target=\\\"_blank\\\" href=\\\"https://theme.sugarat.top/\\\"> ZQ-XU </a>\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zq-xu/zq-xu.github.io\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>